(function () {
    'use strict';

    angular
        .module('app')
        .controller('LocationController', LocationController);

    LocationController.$inject = ['$rootScope', '$routeParams', '$location', '$http', 'FlashService'];
    function LocationController($rootScope, $routeParams, $location, $http, FlashService) {
        
        //$rootScope.default_location = JSON.parse('{"id":{"nome_campo":{"default":"IT","IT":"id","EN":"id","DE":"-"}},"comune":{"nome_campo":{"default":"IT","IT":"comune","EN":"town","DE":"-"}},"localita":{"nome_campo":{"default":"IT","IT":"località","EN":"location","DE":"-"}},"provincia":{"nome_campo":{"default":"IT","IT":"provincia","EN":"province","DE":"-"}},"coordinate":{"nome_campo":{"default":"IT","IT":"coordinate","EN":"coordinate","DE":"-"},"latitudine":{"nome_campo":{"default":"IT","IT":"latitudine","EN":"latitude","DE":"-"}},"longitudine":{"nome_campo":{"default":"IT","IT":"longitudine","EN":"longitude","DE":"-"}}},"qualita_acque":{"nome_campo":{"default":"IT","IT":"qualità delle acque","EN":"water quality","DE":"-"},"stelle":{"nome_campo":{"default":"IT","IT":"stelle","EN":"stars","DE":"-"},"valore":"3"},"classificazione":{"nome_campo":{"default":"IT","IT":"classificazione","EN":"classification","DE":"-"},"valore":{"default":"IT","IT":"Eccellente","EN":"Excellent","DE":"-"}}},"descrizione_area":{"nome_campo":{"default":"IT","IT":"descrizione area","EN":"area desctiption","DE":"-"},"accesso_pubblico":{"nome_campo":{"default":"IT","IT":"accesso pubblico","EN":"pubblic access","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"handicap":{"nome_campo":{"default":"IT","IT":"handicap","EN":"handicap","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"parcheggio":{"nome_campo":{"default":"IT","IT":"parcheggio","EN":"parking","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"servizi_igienici":{"nome_campo":{"default":"IT","IT":"servizi igienici","EN":"toilette","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_pubblica":{"nome_campo":{"default":"IT","IT":"area pubblica","EN":"public area","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_verde":{"nome_campo":{"default":"IT","IT":"area verde","EN":"park","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_privata":{"nome_campo":{"default":"IT","IT":"area privata","EN":"private area","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_pic_nic":{"nome_campo":{"default":"IT","IT":"area pic-nic","EN":"pic-nic area","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_giochi":{"nome_campo":{"default":"IT","IT":"area giochi","EN":"playground area","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"bar_ristorante":{"nome_campo":{"default":"IT","IT":"bar - ristorante","EN":"bar - restaurant","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"attracco_barche":{"nome_campo":{"default":"IT","IT":"attracco barche","EN":"mooring","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"piste_ciclopedonali":{"nome_campo":{"default":"IT","IT":"piste ciclopedonali","EN":"pedestrian and cycling paths","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"strutture_sportive":{"nome_campo":{"default":"IT","IT":"strutture sportive","EN":"sports facilities","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"sport_praticabili":{"nome_campo":{"default":"IT","IT":"sport praticabili","EN":"available sports","DE":"-"},"lista":[{"default":"IT","DE":"-"}]}},"informazioni_utili":{"nome_campo":{"default":"IT","IT":"informazioni utili","EN":"useful information","DE":"-"},"guardia_medica":{"nome_campo":{"default":"IT","IT":"guardia medica","EN":"medical service","DE":"-"},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"pronto_soccorso":{"nome_campo":{"default":"IT","IT":"pronto soccorso","EN":"emergency medical service","DE":"-"},"nome":{"nome_campo":{"default":"IT","IT":"nome","EN":"name","DE":"-"}},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"farmacia":{"nome_campo":{"default":"IT","IT":"farmacia","EN":"drugstore","DE":"-"},"nome":{"nome_campo":{"default":"IT","IT":"nome","EN":"name","DE":"-"}},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"polizia_provinciale":{"nome_campo":{"default":"IT","IT":"polizia provinciale","EN":"provincial police","DE":"-"},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"carabinieri":{"nome_campo":{"default":"IT","IT":"carabinieri","EN":"police","DE":"-"},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"polizia_locale":{"nome_campo":{"default":"IT","IT":"polizia_locale","EN":"local police","DE":"-"},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}}}}');
        //$rootScope.location = {};
        $rootScope.tempdata = { form_disabled: {disabled: true}, dati_localita:{visible: true}, descrizione_area:{visible: false}, informazioni_utili: {visible: false}};
        if($location.absUrl().slice(-8)=="modifica")
        {
            $rootScope.tempdata = { form_disabled: {disabled: false}, dati_localita:{visible: true}, descrizione_area:{visible: true}, informazioni_utili: {visible: true}};
        }
        
        $rootScope.pretty = function() {
            $rootScope.modelData = $rootScope.location;
            return typeof $rootScope.modelData === 'string' ? $rootScope.modelData : angular.toJson($rootScope.modelData, true);
        };
        
        $rootScope.settaQualita = function(indice) {
            var qualita_acque = $rootScope.classificationOption;//JSON.parse('[{"qualita_acque":{"nome_campo":{"default":"IT","IT":"qualità delle acque","EN":"water quality","DE":"-"},"stelle":{"nome_campo":{"default":"IT","IT":"stelle","EN":"stars","DE":"-"},"valore":3},"classificazione":{"nome_campo":{"default":"IT","IT":"classificazione","EN":"classification","DE":"-"},"valore":{"default":"IT","IT":"eccellente","EN":"excellent","DE":"-"}}}},{"qualita_acque":{"nome_campo":{"default":"IT","IT":"qualità delle acque","EN":"water quality","DE":"-"},"stelle":{"nome_campo":{"default":"IT","IT":"stelle","EN":"stars","DE":"-"},"valore":2},"classificazione":{"nome_campo":{"default":"IT","IT":"classificazione","EN":"classification","DE":"-"},"valore":{"default":"IT","IT":"buona","EN":"good","DE":"-"}}}},{"qualita_acque":{"nome_campo":{"default":"IT","IT":"qualità delle acque","EN":"water quality","DE":"-"},"stelle":{"nome_campo":{"default":"IT","IT":"stelle","EN":"stars","DE":"-"},"valore":1},"classificazione":{"nome_campo":{"default":"IT","IT":"classificazione","EN":"classification","DE":"-"},"valore":{"default":"IT","IT":"sufficiente","EN":"sufficient","DE":"-"}}}},{"qualita_acque":{"nome_campo":{"default":"IT","IT":"qualità delle acque","EN":"water quality","DE":"-"},"stelle":{"nome_campo":{"default":"IT","IT":"stelle","EN":"stars","DE":"-"},"valore":0},"classificazione":{"nome_campo":{"default":"IT","IT":"classificazione","EN":"classification","DE":"-"},"valore":{"default":"IT","IT":"scarsa","EN":"poor","DE":"-"}}}}]');
            var posizioneClassificazione= qualita_acque.map(function(x){ return x.qualita_acque.stelle.valore}).indexOf(parseInt(indice));
            var nuovaClassificazione= qualita_acque[posizioneClassificazione].qualita_acque;
            $rootScope.location.qualita_acque= nuovaClassificazione;
        };
        
        $rootScope.aggiungiVoceASport = function() {
            $rootScope.location.descrizione_area.sport_praticabili.lista.push({default: "IT"});
        }
        
        caricaDaAPI();
        
        function caricaDaAPI() {
            var _id = $routeParams.id;
            $http.get(server.api+"/location/"+_id)
                .success(function (response){
                    if(response.success) {
                        $rootScope.location = response.data.location;
                        //$rootScope.location = JSON.parse('{"id":{"nome_campo":{"default":"IT","IT":"id","EN":"id","DE":"-"},"valore":"IT12341234"},"comune":{"nome_campo":{"default":"IT","IT":"comune","EN":"town","DE":"-"},"valore":"merdacacca"},"localita":{"nome_campo":{"default":"IT","IT":"località","EN":"location","DE":"-"},"valore":"caccamerda"},"provincia":{"nome_campo":{"default":"IT","IT":"provincia","EN":"province","DE":"-"},"valore":"BG"},"coordinate":{"nome_campo":{"default":"IT","IT":"coordinate","EN":"coordinate","DE":"-"},"latitudine":{"nome_campo":{"default":"IT","IT":"latitudine","EN":"latitude","DE":"-"},"valore":12},"longitudine":{"nome_campo":{"default":"IT","IT":"longitudine","EN":"longitude","DE":"-"},"valore":12}},"qualita_acque":{"nome_campo":{"default":"IT","IT":"qualità delle acque","EN":"water quality","DE":"-"},"stelle":{"nome_campo":{"default":"IT","IT":"stelle","EN":"stars","DE":"-"},"valore":2},"classificazione":{"nome_campo":{"default":"IT","IT":"classificazione","EN":"classification","DE":"-"},"valore":{"default":"IT","IT":"buona","EN":"good","DE":"-"}}},"descrizione_area":{"nome_campo":{"default":"IT","IT":"descrizione area","EN":"area desctiption","DE":"-"},"accesso_pubblico":{"nome_campo":{"default":"IT","IT":"accesso pubblico","EN":"pubblic access","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"handicap":{"nome_campo":{"default":"IT","IT":"handicap","EN":"handicap","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"parcheggio":{"nome_campo":{"default":"IT","IT":"parcheggio","EN":"parking","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"servizi_igienici":{"nome_campo":{"default":"IT","IT":"servizi igienici","EN":"toilette","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_pubblica":{"nome_campo":{"default":"IT","IT":"area pubblica","EN":"public area","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_verde":{"nome_campo":{"default":"IT","IT":"area verde","EN":"park","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_privata":{"nome_campo":{"default":"IT","IT":"area privata","EN":"private area","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_pic_nic":{"nome_campo":{"default":"IT","IT":"area pic-nic","EN":"pic-nic area","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"area_giochi":{"nome_campo":{"default":"IT","IT":"area giochi","EN":"playground area","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"bar_ristorante":{"nome_campo":{"default":"IT","IT":"bar - ristorante","EN":"bar - restaurant","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"attracco_barche":{"nome_campo":{"default":"IT","IT":"attracco barche","EN":"mooring","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"piste_ciclopedonali":{"nome_campo":{"default":"IT","IT":"piste ciclopedonali","EN":"pedestrian and cycling paths","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"strutture_sportive":{"nome_campo":{"default":"IT","IT":"strutture sportive","EN":"sports facilities","DE":"-"},"servizio_attivo":true,"descrizione":{"nome_campo":{"default":"IT","IT":"desctrizione","EN":"description","DE":"-"},"valore":{"default":"IT","DE":"-"}}},"sport_praticabili":{"nome_campo":{"default":"IT","IT":"sport praticabili","EN":"available sports","DE":"-"},"lista":[{"default":"IT","DE":"-"}]}},"informazioni_utili":{"nome_campo":{"default":"IT","IT":"informazioni utili","EN":"useful information","DE":"-"},"guardia_medica":{"nome_campo":{"default":"IT","IT":"guardia medica","EN":"medical service","DE":"-"},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"pronto_soccorso":{"nome_campo":{"default":"IT","IT":"pronto soccorso","EN":"emergency medical service","DE":"-"},"nome":{"nome_campo":{"default":"IT","IT":"nome","EN":"name","DE":"-"}},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"farmacia":{"nome_campo":{"default":"IT","IT":"farmacia","EN":"drugstore","DE":"-"},"nome":{"nome_campo":{"default":"IT","IT":"nome","EN":"name","DE":"-"}},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"polizia_provinciale":{"nome_campo":{"default":"IT","IT":"polizia provinciale","EN":"provincial police","DE":"-"},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"carabinieri":{"nome_campo":{"default":"IT","IT":"carabinieri","EN":"police","DE":"-"},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}},"polizia_locale":{"nome_campo":{"default":"IT","IT":"polizia_locale","EN":"local police","DE":"-"},"indirizzo":{"nome_campo":{"default":"IT","IT":"indirizzo","EN":"address","DE":"-"}},"telefono":{"nome_campo":{"default":"IT","IT":"telefono","EN":"telephone","DE":"-"}}}},"_id":"9kJHQvmKoVR25ffB"}');
                        //console.log($rootScope.location);
                    }
                    else {
                        FlashService.Error("Error "+response.error.code+": "+response.error.message, true);
                        $location.path("/");
                    }
                })
                .error(function(data, status, headers, config)
                {
                    FlashService.Error("Error 503: service unaviable, check network connection", true);
                    console.log(data);
                    console.log(status);
                    console.log(headers);
                    console.log(config);
                    $location.path("/");
                });
        };
        
        caricaOpzioniClassificazione();
        
        function caricaOpzioniClassificazione() {
            $http.get(server.api+"/valori-qualita-acque")
            .success(function (response){
                if(response.success)
                {
                    $rootScope.classificationOption = response.data.qualita_acque;
                }
                else
                {
                    FlashService.Error("Error "+response.error.code+": "+response.error.message, true);
                    $location.path("/");
                }
            })
            .error(function(data, status, headers, config)
            {
                FlashService.Error("Error 503: service unaviable, check network connection", true);
                console.log(data);
                console.log(status);
                console.log(headers);
                console.log(config);
            });
        }
        
        caricaSchemaValidazione();
        
        function caricaSchemaValidazione() {
            $http.get(server.api+"/schema-validazione-location")
            .success(function (response){
                if(response.success)
                {
                    $rootScope.schema = response.data.schema;
                }
                else
                {
                    FlashService.Error("Error "+response.error.code+": "+response.error.message, true);
                    $location.path("/");
                }
            })
            .error(function(data, status, headers, config)
            {
                FlashService.Error("Error 503: service unaviable, check network connection", true);
                $location.path("/");
                console.log(data);
                console.log(status);
                console.log(headers);
                console.log(config);
            });
        }
        
        $rootScope.uploadFile = function(files) {
            var fd = new FormData();
            //Take the first selected file
            fd.append("file", files[0]);
            $http.put(server.api+"/putfile", fd, {headers: {'Content-Type': undefined }})
                .success(function (response){
                    if(response.success) {
                        //console.log("nuovofilename: ", response.data.filename);
                        $rootScope.location.immagini.lista.push({filename: response.data.filename});
                    }
                    else {
                        FlashService.Error("Error "+response.error.code+": "+response.error.message);
                    }
                })
                .error(function(data, status, headers, config)
                {
                    FlashService.Error("Error 503: service unaviable, check network connection");
                    console.log(data);
                    console.log(status);
                    console.log(headers);
                    console.log(config);
                });
        };
        
        $rootScope.server = {};
        $rootScope.server.api = server.api;
        
        $rootScope.onSubmit = function(form) {
            //var schema = JSON.parse('{"$schema":"http://json-schema.org/draft-04/schema#","id":"/","type":"object","properties":{"id":{"id":"id","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"comune":{"id":"comune","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"localita":{"id":"localita","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"provincia":{"id":"provincia","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"coordinate":{"id":"coordinate","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"latitudine":{"id":"latitudine","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"integer"}}},"longitudine":{"id":"longitudine","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"integer"}}}}},"qualita_acque":{"id":"qualita_acque","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"stelle":{"id":"stelle","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"classificazione":{"id":"classificazione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"descrizione_area":{"id":"descrizione_area","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"accesso_pubblico":{"id":"accesso_pubblico","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"handicap":{"id":"handicap","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"parcheggio":{"id":"parcheggio","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"servizi_igienici":{"id":"servizi_igienici","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_pubblica":{"id":"area_pubblica","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_verde":{"id":"area_verde","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_privata":{"id":"area_privata","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_pic_nic":{"id":"area_pic_nic","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_giochi":{"id":"area_giochi","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"bar_ristorante":{"id":"bar_ristorante","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"attracco_barche":{"id":"attracco_barche","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"piste_ciclopedonali":{"id":"piste_ciclopedonali","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"strutture_sportive":{"id":"strutture_sportive","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"sport_praticabili":{"id":"sport_praticabili","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"lista":{"id":"lista","type":"array","items":{"id":"0","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}}},"informazioni_utili":{"id":"informazioni_utili","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"guardia_medica":{"id":"guardia_medica","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"pronto_soccorso":{"id":"pronto_soccorso","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"nome":{"id":"nome","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"farmacia":{"id":"farmacia","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"nome":{"id":"nome","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"polizia_provinciale":{"id":"polizia_provinciale","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"carabinieri":{"id":"carabinieri","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"polizia_locale":{"id":"polizia_locale","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}}}},"_id":{"id":"_id","type":"string"}}}');
            var schema =  $rootScope.schema;//JSON.parse('{"$schema":"http://json-schema.org/draft-04/schema#","id":"/","type":"object","properties":{"id":{"id":"id","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}},"required":["nome_campo","valore"]},"comune":{"id":"comune","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"localita":{"id":"localita","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"provincia":{"id":"provincia","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"coordinate":{"id":"coordinate","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"latitudine":{"id":"latitudine","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"integer"}}},"longitudine":{"id":"longitudine","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"integer"}}}}},"qualita_acque":{"id":"qualita_acque","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"stelle":{"id":"stelle","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"number"}}},"classificazione":{"id":"classificazione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"descrizione_area":{"id":"descrizione_area","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"accesso_pubblico":{"id":"accesso_pubblico","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"handicap":{"id":"handicap","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"parcheggio":{"id":"parcheggio","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"servizi_igienici":{"id":"servizi_igienici","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_pubblica":{"id":"area_pubblica","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_verde":{"id":"area_verde","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_privata":{"id":"area_privata","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_pic_nic":{"id":"area_pic_nic","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"area_giochi":{"id":"area_giochi","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"bar_ristorante":{"id":"bar_ristorante","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"attracco_barche":{"id":"attracco_barche","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"piste_ciclopedonali":{"id":"piste_ciclopedonali","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"strutture_sportive":{"id":"strutture_sportive","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"servizio_attivo":{"id":"servizio_attivo","type":"boolean"},"descrizione":{"id":"descrizione","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}},"sport_praticabili":{"id":"sport_praticabili","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"lista":{"id":"lista","type":"array","items":{"id":"0","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}}}}}}},"informazioni_utili":{"id":"informazioni_utili","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"guardia_medica":{"id":"guardia_medica","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"pronto_soccorso":{"id":"pronto_soccorso","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"nome":{"id":"nome","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"farmacia":{"id":"farmacia","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"nome":{"id":"nome","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"polizia_provinciale":{"id":"polizia_provinciale","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"carabinieri":{"id":"carabinieri","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}},"polizia_locale":{"id":"polizia_locale","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"indirizzo":{"id":"indirizzo","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}},"telefono":{"id":"telefono","type":"object","properties":{"nome_campo":{"id":"nome_campo","type":"object","properties":{"default":{"id":"default","type":"string"},"IT":{"id":"IT","type":"string"},"EN":{"id":"EN","type":"string"},"DE":{"id":"DE","type":"string"}}},"valore":{"id":"valore","type":"string"}}}}}}},"_id":{"id":"_id","type":"string"}}}');
            var location = $rootScope.location;
            var valid = tv4.validate(location, schema);
            if(!valid) {
                FlashService.Error("Form non valido: controlla il campo ["+tv4.error.dataPath+"]");
                console.log(tv4.error, tv4.missing);
            }
            else {
                //$http.put(server.api+"/locations/"+location._id, { updateValue: location })
                //test variant! 
                $http.put(server.api+"/location/"+location._id, { updateValue: location })
                .success(function (response){
                    if(response.success) {
                        FlashService.Success("Dati salvati correttamente", true);
                        $location.path("/");
                    }
                    else {
                        FlashService.Error("Error "+response.error.code+": "+response.error.message);
                    }
                })
                .error(function(data, status, headers, config)
                {
                    FlashService.Error("Error 503: service unaviable, check network connection");
                    console.log(data);
                    console.log(status);
                    console.log(headers);
                    console.log(config);
                });
            }
        }
    };
})();
